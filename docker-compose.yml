services:
  auth-service:
    build:
      context: .
      dockerfile: services/auth-service/Dockerfile
    container_name: ft_transcendence_auth
    working_dir: /app/services/auth-service
    ports:
     - "3010:3010"
    environment:
      - NODE_ENV=production
      - DATABASE_URL=file:/app/database/transcendence.db
      - JWT_SECRET=transcendence-secret-key-change-in-production
      - PRISMA_HIDE_UPDATE_MESSAGE=true
      - PRISMA_DISABLE_WARNINGS=true
    volumes:
      - ./database:/app/database:rw
    networks:
      - transcendence-network
    restart: unless-stopped
    # command: ["node", "dist/server.js"]  # Commented out to use Dockerfile CMD which includes migration

  chat-service:
    build:
      context: .
      dockerfile: services/chat-service/Dockerfile
    container_name: ft_transcendence_chat
    # working_dir: /app/services/chat-service  # Let Dockerfile handle working directory
    ports:
      - "3011:3011"
    environment:
      - NODE_ENV=production
      - JWT_SECRET=transcendence-secret-key-change-in-production
      - DATABASE_URL=file:/app/database/transcendence.db
      - AUTH_SERVICE_URL=http://auth-service:3010
      - PRISMA_HIDE_UPDATE_MESSAGE=true
      - PRISMA_DISABLE_WARNINGS=true
    volumes:
      - ./database:/app/database:rw
    networks:
      - transcendence-network
    depends_on:
      - auth-service
    restart: unless-stopped
    # command: ["node", "dist/server.js"]  # Commented out to use Dockerfile CMD

  game-service:
    build:
      context: .
      dockerfile: services/game-service/Dockerfile
    container_name: ft_transcendence_game
    # working_dir: /app/services/game-service  # Let Dockerfile handle working directory
    ports:
      - "3012:3012"
    environment:
      - JWT_SECRET=transcendence-secret-key-change-in-production
      - DATABASE_URL=file:/app/database/transcendence.db
      - AUTH_SERVICE_URL=http://auth-service:3010
      - AI_SERVICE_URL=ws://ai-service:3013/
      - PRISMA_HIDE_UPDATE_MESSAGE=true
      - PRISMA_DISABLE_WARNINGS=true
    volumes:
      - ./services/game-service:/app/services/game-service:rw
      - /app/services/game-service/node_modules
      - ./database:/app/database:rw
      - ./Shared_dataBase:/app/Shared_dataBase
    networks:
      - transcendence-network
    depends_on:
      - auth-service
      - ai-service
    restart: unless-stopped
    # command: ["node", "dist/server.js"]  # Commented out to use Dockerfile CMD

  ai-service:
    build:
      context: .
      dockerfile: services/ai-service/Dockerfile
    container_name: ft_transcendence_ai
    # working_dir: /app/services/ai-service  # Let Dockerfile handle working directory
    ports:
      - "3013:3013"
    environment:
      - NODE_ENV=production
      - DATABASE_URL=file:/app/database/transcendence.db
      - GAME_SERVICE_URL=http://game-service:3012
      - PRISMA_HIDE_UPDATE_MESSAGE=true
      - PRISMA_DISABLE_WARNINGS=true
    volumes:
      - ./database:/app/database:rw
    networks:
      - transcendence-network
    restart: unless-stopped
    # command: ["node", "dist/server.js"]  # Commented out to use Dockerfile CMD

networks:
  transcendence-network:
    driver: bridge

volumes:
  database-data:
    driver: local
